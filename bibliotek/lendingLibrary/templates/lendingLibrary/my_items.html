{% extends 'lendingLibrary/base.html' %}

{% block title %}
<title>My Items - Neighborhood Lending Library</title>
{% endblock %}

{% block heading %}
<h2>My Items</h2>
{% endblock %}

{% block content %}
  <div id="item_list"> <!-- start of 'item_list' -->
    {% if items %}
      <table>
        <tr>
          <th>Category</th>
          <th style="text-align:left">Item</th>
          <th style="text-align:left">Description</th>
          <th>Status</th>
          <th>Borrower</th>
        </tr>
        {% for item in items %}
        <tr>
          <td style="text-align:center"><a href="{% url 'lendingLibrary:category' item.category %}">{{item.category}}</a></td>
          {% if item.category.name == "Books" %}
            <td><span class="item_title">"<a href="{% url 'lendingLibrary:item_details' item.id item.slug %}">{{item.name}}</a>"</span></td>
          {% else %}
            <td><span class="item_title"><a href="{% url 'lendingLibrary:item_details' item.id item.slug %}">{{item.name}}</a></span></td>
          {% endif %}
          {% if item.description != '' %}
            <td><span class="item_description">{{item.description}}</span></td>
          {% else %}
            <td><span class="item_description"><i>no description</i></span></td>
          {% endif %}
          {% if item.item_status.name == 'Available' %}
            <td style="background-color:lightgreen;text-align:center">{{item.item_status}}</td>
          {% elif item.item_status.name == 'Requested' %}
            <td style="background-color:blue;color:#FFF;text-align:center">{{item.item_status}}</td>
          {% elif item.item_status.name == 'Checked Out' %}
            {% for request in item_requests %}
              {% if request.user_item.name == item.name %}
              <td style="background-color:pink;text-align:center"><form action="{% url 'lendingLibrary:item_check_in' %}" method="post">{% csrf_token%}<input type="hidden" name="item_request_id" value="{{request.id}}"><button type="submit">Check In</button></form></td>
              {% endif %}
            {% endfor %}
          {% elif item.item_status.name == 'Unavailable' %}
            <td style="background-color:yellow;text-align:center">{{item.item_status}}</td>
          {% elif item.item_status.name == 'Hidden' %}
            <td style="background-color:#777;color:#FFF;text-align:center">{{item.item_status}}</td>
          {% elif item.item_status.name == 'Lost' %}
            <td style="background-color:#333;color:#FFF;text-align:center">{{item.item_status}}</td>
          {% endif %}
          {% for request in item_requests %}
            {% if request.user_item.name == item.name and request.checkout_status.name != 'Completed' %}
              <td align="center">{{request.borrower.username|title}}</td>
            {% endif %}
          {% endfor %}
          {% if item.item_status.name in filter %}
            <td>&nbsp;</td>
          {% endif %}
        </tr>
        {% endfor %}
      </table>
    {% else %}
      <p><i>You don't have any items to lend</i></p>
    {% endif %}
  </div> <!-- end of 'item_list' -->
{% endblock %}
