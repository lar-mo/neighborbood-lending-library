{% extends 'lendingLibrary/base.html' %}

{% block title %}
<title>Add Item - Neighborhood Lending Library</title>
{% endblock %}

{% block heading %}
<h2>Manage Your Items</h2>
{% endblock %}

{% block content %}

{% include "lendingLibrary/manage_html_js.html" %}

<div class="spacer"></div>
<div id="new_item"> <!-- start of 'new_item' -->
  <table>
    <tr>
      <th><h2>Add a new item</h2></th>
    </tr>
    <tr>
      <td>
        <div class="add_edit_form_div">
          <form action="{% url 'lendingLibrary:create_new_item' %}" method="post" name="new_item_form" id="new_item_form">
            {% csrf_token %}
            <div class="field_label">Item Name</div>
            <div>
              <input name="name" type="text" id="name_field" style="width: 300px" required>
            </div>
            <div class="field_label">Description</div>
            <div>
              <textarea name="description" style="width: 300px"></textarea>
            </div>
            <div class="field_label">Image URL</div>
            <div>
              <input name="image_url" type="text" style="width: 300px">
            </div>
            <div class="field_label">Category</div>
            <div>
              <select name="category" style="width: 300px" required>
                <option value="" selected disabled>-----</option>
                {% for category in categories %}
                  <option value="{{category.id}}">{{category.name}}</option>
                {% endfor %}
              </select>
            </div>
            <div class="field_label">Condition</div>
            <div>
              <select name="condition" style="width: 300px" required>
                <option value="" selected disabled>-----</option>
                {% for condition in conditions %}
                  <option value="{{condition.id}}">{{condition.name}}</option>
                {% endfor %}
              </select>
            </div>
            <div class="field_label">Replacement Cost</div>
            <div>
              &#36;&nbsp;<input name="replacement_cost" type="number" step="0.01" style="width: 300px" required>
            </div>
            <input type="hidden" name="item_status" value="8"/>
            <input type="hidden" name="name_slug" id="name_slug"/>
            <div class="form_submit_div">
              <input type="submit" value="Create item" class="form_submit_button" onclick="javascript:populate_name_slug()"/>
            </div>
          </form>
        </div>
      </td>
    </tr>
  </table>
</div> <!-- end of 'new_item' -->
<script type="text/javascript">
  function slugify(string) {
    const a = 'àáäâãåăæąçćčđďèéěėëêęğǵḧìíïîįłḿǹńňñòóöôœøṕŕřßşśšșťțùúüûǘůűūųẃẍÿýźžż·/_,:;'
    const b = 'aaaaaaaaacccddeeeeeeegghiiiiilmnnnnooooooprrsssssttuuuuuuuuuwxyyzzz------'
    const p = new RegExp(a.split('').join('|'), 'g')

    return string.toString().toLowerCase()
      .replace(/\s+/g, '-') // Replace spaces with -
      .replace(p, c => b.charAt(a.indexOf(c))) // Replace special characters
      .replace(/&/g, '-and-') // Replace & with 'and'
      .replace(/[^\w\-]+/g, '') // Remove all non-word characters
      .replace(/\-\-+/g, '-') // Replace multiple - with single -
      .replace(/^-+/, '') // Trim - from start of text
      .replace(/-+$/, '') // Trim - from end of text
  }
  function populate_name_slug() {
    let name_field = document.querySelector('#name_field')
    let name_slug_field = document.querySelector('#name_slug')
    name_slug = slugify(name_field.value)
    name_slug_field.setAttribute('value',name_slug)
  }
</script>
{% endblock %}
